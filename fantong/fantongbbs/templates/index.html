
{% extends "indexbase.html" %}
{% load staticfiles %}
	{% block js %}
    <script type="text/javascript">
    	$(function() {
    	{% for post in posts %}
    	var s = '{{post.PContent}}'
    	p = s.match(/__url_start__(\S*?)__url_end__/)
    	while (!(p === null)) {
    		s = s.replace(p[0], "<img src='media/" + p[1] + "' />")
    		p = s.match(/__url_start__(\S*?)__url_end__/)
    	}
    	$('#post_{{post.id}}').html(s)
        if (!('{{post.PKeywords}}' === '')) {
            $('#keyword_{{post.id}} th').html('关键词：' + $.trim('{{post.PKeywords}}').replace(/\s+/g,','))
        }
    	{% endfor %}
    });
    </script>
{% endblock %}

{% block title %}论坛主页{% endblock %}

{% block content %}
<div class="container">
	<div class="row">
		<table class="table">
			<thead>
				<tr>
					<th class="col-lg-8">帖子标题</th>
					<th class="col-lg-2">发帖人</th>
					<th class="col-lg-2">发帖时间</th>
				</tr>
			</thead>
			<tbody>
				{% for post in posts %}
				<tr>
					<th class="col-lg-8">
						<a class="posttitle" href="/bbs_post_detail/{{post.id}}">{{post.PTitle}}</a>
					</th>
					<th class="col-lg-2">{{post.PUserID}}</th>
					<th class="col-lg-2">{{post.PTime}}</th>
				</tr>
                <tr class="keywords" id="keyword_{{post.id}}">
                    <th colspan=3>关键词:</th>
                </tr>
				{% endfor %}
			</tbody>
		</table>
	</div>
	</div>

{% if user.user.is_authenticated %}
<div class="reply">
	<hr>
	<input id="fileImage" type="file" size="30"/>
	<form method="POST" class="post-form">{% csrf_token %}
		{{form.as_p}}
		<button type="submit" class="save btn btn-default">发帖</button>
	</form>
</div>
{% endif %}
{% endblock %}